<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>招金 線上點餐</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light">
  <style>
    .card{border-radius:1rem}.btn{border-radius:1rem}.badge{border-radius:999px}
    .container-slim{max-width:1200px}.mono{font-variant-numeric:tabular-nums}
    input,select,textarea,option,button{color-scheme:light}
    input,select,textarea{background:#fff!important;color:#0f172a!important;-webkit-text-fill-color:#0f172a;border-color:#cbd5e1}
    select option{background:#fff;color:#0f172a}
    .scroll-y{overflow-y:auto;-webkit-overflow-scrolling:touch}
    .hidden-imp{display:none!important}

    /* === 大類配色：A/B 交錯 === */
    :root{
      --cat-a:#242d47; /* 深藍灰 */
      --cat-b:#c9141a; /* 紅 */
      --cat-a-bg:#f7f8fb; /* 很淡的背景 */
      --cat-b-bg:#fff6f6;
    }

    /* 大類容器（左側色條 + 淡底） */
    .category-block{
      position: relative;
      padding: 14px 14px 6px 14px;
      border-radius: 16px;
    }
    .category-block::before{
      content:"";
      position:absolute; inset:0;
      border-radius:16px;
      z-index:0;
      opacity:.55;
    }
    .category-block.cat-a::before{ background: var(--cat-a-bg); }
    .category-block.cat-b::before{ background: var(--cat-b-bg); }

    /* 左側色條（更好辨識） */
    .category-block::after{
      content:"";
      position:absolute; left:-6px; top:10px; bottom:10px;
      width:4px; border-radius:4px;
    }
    .category-block.cat-a::after{ background: var(--cat-a); }
    .category-block.cat-b::after{ background: var(--cat-b); }

    /* 大類標題：同色底線 & 小圓點 */
    .category-title{
      position:relative; padding-left:18px;
      font-weight:600;
    }
    .category-title::before{
      content:"";
      position:absolute; left:0; top:.55em;
      width:10px; height:10px; border-radius:999px;
      transform: translateY(-50%);
    }
    .cat-a .category-title{ color:#0f172a; }
    .cat-b .category-title{ color:#0f172a; }
    .cat-a .category-title::before{ background: var(--cat-a); }
    .cat-b .category-title::before{ background: var(--cat-b); }
    .category-underline{
      height:2px; border-radius:999px; margin-top:4px;
    }
    .cat-a .category-underline{ background: var(--cat-a); }
    .cat-b .category-underline{ background: var(--cat-b); }

    /* 卡片上方細色條（與大類顏色一致） */
    .cat-a .menu-card::before,
    .cat-b .menu-card::before{
      content:""; display:block; height:3px; border-radius:8px 8px 0 0; margin:-1rem -1rem 8px -1rem;
    }
    .cat-a .menu-card::before{ background: var(--cat-a); }
    .cat-b .menu-card::before{ background: var(--cat-b); }

    /* 快速分類導覽（貼頂次導覽） */
    .category-nav{
      position:sticky; top:64px; z-index:20;
      background:rgba(255,255,255,.85); backdrop-filter: blur(6px);
      border-bottom:1px solid #e2e8f0;
    }
    .category-chip{
      border-radius:999px; padding:.45rem .8rem; border:1px solid #cbd5e1;
      font-size:.875rem; line-height:1;
    }
    .chip-a{ border-color: color-mix(in srgb, var(--cat-a) 45%, #cbd5e1); }
    .chip-b{ border-color: color-mix(in srgb, var(--cat-b) 45%, #cbd5e1); }
    .chip-a.active{ background:var(--cat-a); color:#fff; border-color:transparent; }
    .chip-b.active{ background:var(--cat-b); color:#fff; border-color:transparent; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 selection:bg-slate-200 selection:text-slate-900">
<header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-slate-200">
  <div class="mx-auto container-slim px-4 py-4 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-slate-900 text-white rounded-xl grid place-items-center text-lg font-bold select-none">招</div>
      <div>
        <div class="text-xl font-semibold">招金 線上點餐</div>
        <div class="text-xs text-slate-500">營業時間: 每週二、三、四 16:00-20:00（每15分鐘為一時段）</div>
        <div class="text-xs text-slate-500">每人內用低消50元，禁帶外食</div>
      </div>
    </div>
    <a href="#cart" class="btn px-3 py-2 border border-slate-300 hover:bg-slate-100">購物車</a>
  </div>

  <!-- 快速分類導覽（新增） -->
  <div class="category-nav">
    <div class="mx-auto container-slim px-4 py-2 flex flex-wrap gap-6">
      <a href="#sec-hotpot" class="category-chip chip-a" data-chip="hotpot">鍋燒系列</a>
      <a href="#sec-full"   class="category-chip chip-b" data-chip="full">呷飽飽系列</a>
      <a href="#sec-soup"   class="category-chip chip-a" data-chip="soup">喝湯</a>
      <a href="#sec-tea"    class="category-chip chip-b" data-chip="tea">喝茶</a>
      <a href="#sec-donut"  class="category-chip chip-a" data-chip="donut">呷甜（甜甜圈）</a>
    </div>
  </div>
</header>

<main class="mx-auto container-slim px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
  <section class="lg:col-span-2 space-y-8">
    <!-- A 類 -->
    <div id="sec-hotpot" class="category-block cat-a space-y-3">
      <h2 class="category-title text-lg">鍋燒系列</h2>
      <div class="category-underline"></div>
      <div id="hotpotList" class="grid grid-cols-2 gap-4"></div>
    </div>

    <!-- B 類 -->
    <div id="sec-full" class="category-block cat-b space-y-3">
      <h2 class="category-title text-lg">呷飽飽系列</h2>
      <div class="category-underline"></div>
      <div id="fullList" class="grid grid-cols-2 gap-4"></div>
    </div>

    <!-- A 類 -->
    <div id="sec-soup" class="category-block cat-a space-y-3">
      <h2 class="category-title text-lg">喝湯</h2>
      <div class="category-underline"></div>
      <div id="soupList" class="grid grid-cols-2 gap-4"></div>
    </div>

    <!-- B 類 -->
    <div id="sec-tea" class="category-block cat-b space-y-3">
      <h2 class="category-title text-lg">喝茶</h2>
      <div class="category-underline"></div>
      <div id="teaList" class="grid grid-cols-2 gap-4"></div>
    </div>

    <!-- A 類 -->
    <div id="sec-donut" class="category-block cat-a space-y-3">
      <h2 class="category-title text-lg">呷甜（甜甜圈）</h2>
      <div class="category-underline"></div>
      <div id="donutList" class="grid grid-cols-2 gap-4"></div>
    </div>
  </section>

  <aside id="cart"
    class="space-y-6 lg:sticky lg:top-[132px] lg:max-h-[calc(100vh-160px)] lg:overflow-y-auto lg:pr-1"
    style="-webkit-overflow-scrolling: touch;">
    <div class="card bg-white p-5">
      <h2 class="text-lg font-semibold mb-4">購物車</h2>
      <div id="cartItems" class="space-y-3"></div>
      <div class="border-t pt-4 mt-4 flex items-center justify-between text-lg font-semibold">
        <div>總計</div>
        <div id="cartTotal" class="mono">$0</div>
      </div>
      <button id="clearCart" class="mt-3 w-full btn px-4 py-2 border border-slate-300 hover:bg-slate-100">清空購物車</button>
    </div>

    <div class="card bg-white p-5">
      <h2 class="text-lg font-semibold mb-4">取餐資訊</h2>
      <form id="checkoutForm" class="space-y-4" autocomplete="off">
        <!-- 用餐方式 -->
        <div>
          <label class="text-sm text-slate-600">用餐方式</label>
          <div class="mt-2 grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 border rounded-xl px-3 py-2 cursor-pointer">
              <input type="radio" name="diningType" value="takeout" checked>
              <span>外帶</span>
            </label>
            <label class="flex items-center gap-2 border rounded-xl px-3 py-2 cursor-pointer">
              <input type="radio" name="diningType" value="dinein">
              <span>內用</span>
            </label>
          </div>
        </div>

        <!-- 外帶：取餐時間 -->
        <div id="takeoutBlock">
          <label class="text-sm text-slate-600">取餐時間（未選則自動安排最早可取時段）</label>
          <select id="pickupSelect"
                  class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 bg-white text-slate-900">
          </select>
          <p id="pickupHint" class="text-xs text-slate-500 mt-1">營業時段：16:00–20:00；每 15 分鐘一個時段。</p>
          <p id="offHourMsg" class="text-sm text-amber-700 mt-2 hidden-imp">目前非可取時段，您仍可下單，但將自動安排至下一個可取時段。</p>
        </div>

        <!-- 內用：桌號 -->
        <div id="dineinBlock" class="hidden">
          <label class="text-sm text-slate-600">桌號</label>
          <input id="tableNo" type="text" placeholder=""
                 class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 bg-white text-slate-900" />
        </div>

        <!-- 姓名/電話 -->
        <div>
          <label class="text-sm text-slate-600">姓名</label>
          <input required id="customerName" type="text"
                 class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 bg-white text-slate-900" />
        </div>
        <div>
          <label class="text-sm text-slate-600">電話</label>
          <input required id="customerPhone" type="tel" pattern="[0-9\-+\s]{8,}" placeholder="09xx-xxx-xxx"
                 class="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 bg-white text-slate-900" />
        </div>

        <button id="submitBtn" type="submit" class="w-full btn px-4 py-3 bg-slate-900 text-white hover:bg-slate-800">送出訂單</button>
        <p id="formError" class="text-sm text-red-600"></p>
      </form>
    </div>
  </aside>
</main>

<!-- 成功視窗（原樣） -->
<div id="successModal" class="fixed inset-0 z-40 hidden">
  <div class="absolute inset-0 bg-black/40"></div>
  <div class="relative z-10 mx-auto mt-24 w-[92%] max-w-xl card bg-white p-6">
    <h3 class="text-xl font-semibold mb-4">下單成功</h3>

    <div class="space-y-2">
      <p class="text-slate-700">取餐編號</p>
      <p id="pickupNoText" class="text-4xl font-extrabold tracking-wider mt-1 mono"></p>
    </div>

    <div id="successTakeoutTime" class="space-y-2 mt-4 hidden">
      <p class="text-slate-700">取餐時間</p>
      <p id="pickupTimeText" class="text-2xl font-bold mt-1 mono"></p>
    </div>

    <div id="successTable" class="space-y-2 mt-4 hidden">
      <p class="text-slate-700">桌號</p>
      <p id="tableNoText" class="text-2xl font-bold mt-1 mono"></p>
    </div>

    <div class="mt-6 flex justify-end">
      <button id="closeSuccess" class="btn px-4 py-2 border border-slate-300 hover:bg-slate-100">關閉</button>
    </div>
  </div>
</div>

<footer class="border-t border-slate-200 mt-12">
  <div class="mx-auto container-slim px-4 py-6 text-sm text-slate-600">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>© <span id="year"></span> 招金</div>
    </div>
  </div>
</footer>

<script>
/* === 設定 === */
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxPUORCVfBpz7C9l3l8eC7-0ItcMiQrFtiN7f5lAAWwL2oVat1Xv7GST55HgRh7P4wuzA/exec';
const API_KEY  = 'zhaojin';

/* === 工具 & 狀態 === */
const el = s => document.querySelector(s);
const money = n => '$' + Number(n||0).toLocaleString('zh-Hant');
const pad2 = n => String(n).padStart(2, '0');
const state = { cart: [], slots: [] };

/* === 快速分類導覽：滾動高亮（新增，非必需） === */
const chips = Array.from(document.querySelectorAll('.category-chip'));
const sections = [
  { id:'hotpot', el: document.getElementById('sec-hotpot') },
  { id:'full',   el: document.getElementById('sec-full') },
  { id:'soup',   el: document.getElementById('sec-soup') },
  { id:'tea',    el: document.getElementById('sec-tea') },
  { id:'donut',  el: document.getElementById('sec-donut') },
];
const obs = new IntersectionObserver((entries)=>{
  // 取最靠近視窗頂端的可見區塊
  const visible = entries
    .filter(e=>e.isIntersecting)
    .sort((a,b)=> a.boundingClientRect.top - b.boundingClientRect.top)[0];
  if (!visible) return;
  const id = visible.target.id.replace('sec-','');
  chips.forEach(c=>{
    c.classList.toggle('active', c.dataset.chip===id);
  });
},{ rootMargin:"-40% 0px -55% 0px", threshold:[0, .25, .5, .75, 1]});
sections.forEach(s=> s.el && obs.observe(s.el));
chips.forEach(c=>{
  c.addEventListener('click', e=>{
    e.preventDefault();
    const target = document.querySelector(c.getAttribute('href'));
    if (target) target.scrollIntoView({ behavior:'smooth', block:'start' });
  });
});

/* === 參數：營業時間 === */
const BUSINESS = { startHour:16, endHour:20, intervalMin:15 };

/* === 鍋燒主食選項 === */
const HOTPOT_STAPLES = ["意麵","雞絲","冬粉","泡麵","飯"];

/* === 菜單 === */
const MENU = {
  hotpot: [
    { id:"hp_orig",   name:"原味鍋燒",     price:80,  requireStaple:true },
    { id:"hp_kimchi", name:"泡菜鍋燒",     price:85,  requireStaple:true },
    { id:"hp_thai",   name:"泰式鍋燒",     price:95,  requireStaple:true },
    { id:"hp_clam",   name:"蛤蜊爆棚鍋燒", price:150, requireStaple:true },
    { id:"hp_shrimp", name:"有夠蝦鍋燒",   price:150, requireStaple:true },
    { id:"hp_purine", name:"通痛風鍋燒",   price:170, requireStaple:true },
  ],
  full: [
    { id:"full_minced_pork_rice", name:"懷舊肉燥飯",   price:35,  noStaple:true },
    { id:"full_rice_noodle",      name:"古味炒米粉",   price:40,  noStaple:true },
    { id:"full_kongrou",          name:"復刻爌肉飯",   price:70,  noStaple:true },
    { id:"full_basil_pork",       name:"台式打拋豬",   price:70,  noStaple:true },
    { id:"full_mixed_chicken",    name:"肉燥雞絲飯",   price:65,  noStaple:true },
    { id:"full_thai_chicken",     name:"泰式雞絲飯",   price:60,  noStaple:true },
    { id:"full_stir_chicken",     name:"香炒雞肉片飯", price:75,  noStaple:true },
    { id:"full_curry",            name:"招金咖喱飯",   price:75,  noStaple:true },
    { id:"full_fried_instant",    name:"炒泡麵",       price:75,  noStaple:true },
    { id:"full_bbq_box",          name:"巴比Ｑ烤肉餐盒", price:85, noStaple:true },
    { id:"full_greenonion_pork",  name:"蔥爆豬肉",     price:85,  noStaple:true },
    { id:"full_pan_chicken_leg",  name:"香煎雞腿",     price:85,  noStaple:true },
    { id:"full_chili_chicken",    name:"椒麻雞腿",     price:85,  noStaple:true },
    { id:"full_pan_pork_chop",    name:"香煎排骨",     price:85,  noStaple:true },
    { id:"full_fried_chicken_lu", name:"炸雞滷肉飯",   price:80,  noStaple:true },
    { id:"full_crispy_chicken",   name:"香酥雞排飯",   price:70,  noStaple:true },
  ],
  soup: [
    { id:"soup_egg",      name:"蛋花湯",       price:30, noStaple:true },
    { id:"soup_meatball", name:"貢丸湯",       price:30, noStaple:true },
    { id:"soup_seaweed",  name:"紫菜蛋花湯",   price:40, noStaple:true },
    { id:"soup_clam",     name:"蛤仔湯",       price:40, noStaple:true },
  ],
  tea: [
    { id:"tea_black",   name:"紅茶",   price:30, noStaple:true },
    { id:"tea_winter",  name:"冬瓜茶", price:30, noStaple:true },
  ],
  donut: [
    { id:"donut_orig",     name:"原味甜甜圈",     price:30, noStaple:true },
    { id:"donut_peanut",   name:"花生甜甜圈",     price:40, noStaple:true },
    { id:"donut_straw",    name:"草莓甜甜圈",     price:35, noStaple:true },
    { id:"donut_cheese",   name:"起司甜甜圈",     price:45, noStaple:true },
    { id:"donut_secret",   name:"隱藏版甜甜圈",   price:50, noStaple:true },
    { id:"donut_garlic",   name:"蒜香甜甜圈",     price:35, noStaple:true },
    { id:"donut_choco",    name:"巧克力甜甜圈",   price:35, noStaple:true },
    { id:"donut_milk",     name:"奶酥甜甜圈",     price:35, noStaple:true },
    { id:"donut_mochi",    name:"麻糬甜甜圈",     price:45, noStaple:true },
    { id:"donut_taro",     name:"芋頭甜甜圈",     price:45, noStaple:true },
  ],
};

/* === Render（維持你原本流程；僅在卡片根節點加上 menu-card class 以套色條） === */
function renderCategory(list, targetId){
  const root = el(targetId); root.innerHTML='';
  list.forEach(item=>{
    const card=document.createElement('div');
    card.className='card menu-card bg-white p-4 flex flex-col';
    card.innerHTML=`
      <div class="flex items-start justify-between gap-3">
        <div><h3 class="text-lg font-semibold">${item.name}</h3></div>
        <div class="text-right font-semibold mono">${money(item.price)}</div>
      </div>
      <div class="mt-4 flex justify-end">
        <button class="choose-btn btn px-4 py-2 bg-slate-900 text-white hover:bg-slate-800"
                data-name="${item.name}" data-sku="">
          選擇
        </button>
      </div>`;
    card.querySelector('button').addEventListener('click', ()=> openItemModal(item));
    root.appendChild(card);
  });
}

/* === 其餘 JS（你的原本流程照舊，下方只省略與分類無關的函式內容） === */

/* 小工具 & API 錯誤映射 */
function mapApiError(errCode, serverMessage){
  const code = String(errCode || '').toLowerCase();
  if (code === 'paused') return '目前商家停止接單';
  return serverMessage || '送單失敗，請稍後再試';
}

/* 省略：openItemModal / cart / slot / api / submit / sold-out 同你現版 */
/* ===== 你可直接貼回原本這些函式 ===== */

/* === 簡化示範：只保留必要初始化（請把你現有的函式原封不動貼回） === */
function generateSlots(d=new Date()){return[]}
function fillPickupSelect(){}
function onSubmitOrder(e){e.preventDefault();}
function openItemModal(){}
function enforceSoldOutOnMenu(){}

/* === Init === */
document.addEventListener('DOMContentLoaded',()=>{
  el('#year').textContent=new Date().getFullYear();

  renderCategory(MENU.hotpot,'#hotpotList');
  renderCategory(MENU.full,'#fullList');
  renderCategory(MENU.soup,'#soupList');
  renderCategory(MENU.tea,'#teaList');
  renderCategory(MENU.donut,'#donutList');

  // 你的其它初始化邏輯照舊，例如：
  // renderCart(); initSlots(); 綁定表單等…
});
</script>
</body>
</html>
